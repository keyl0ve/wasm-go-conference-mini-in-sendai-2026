<!doctype html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mario Game - Ebitengine</title>
    <style>
      body {
        margin: 0;
        padding: 0;
        background: #1a1a2e;
        color: #eee;
        font-family: sans-serif;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
      }
      #loading {
        text-align: center;
        padding: 2rem;
      }
      #loading.hidden {
        display: none;
      }
      .spinner {
        width: 40px;
        height: 40px;
        border: 3px solid rgba(255, 255, 255, 0.2);
        border-top-color: #4ade80;
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
        margin: 0 auto 1rem;
      }
      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }
      canvas {
        display: block;
        background: #000;
      }
    </style>
  </head>
  <body>
    <div id="loading">
      <div class="spinner"></div>
      <p>Loading game...</p>
    </div>
    <script src="wasm_exec.js"></script>
    <script>
      (function () {
        const loading = document.getElementById("loading");
        function hideLoading() {
          loading.classList.add("hidden");
        }
        function showError(msg) {
          loading.innerHTML = '<p style="color:#f87171">' + msg + "</p>";
        }
        if (!WebAssembly.instantiateStreaming) {
          WebAssembly.instantiateStreaming = async (resp, importObject) => {
            const source = await (await resp).arrayBuffer();
            return WebAssembly.instantiate(source, importObject);
          };
        }
        const go = new Go();
        fetch("mario-game.wasm")
          .then((response) => response.arrayBuffer())
          .then((bytes) => WebAssembly.instantiate(bytes, go.importObject))
          .then((result) => {
            hideLoading();
            go.run(result.instance);
          })
          .catch((err) => showError("Failed to load game: " + err));
      })();
    </script>
  </body>
</html>
